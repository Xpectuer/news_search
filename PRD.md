# News Agent - 新闻收集器 PRD

## 📋 产品概述

### 产品名称
News Agent - 智能新闻收集器

### 产品愿景
打造一个功能强大、易于使用的新闻收集工具，帮助用户从多个数据源自动收集、过滤和存储新闻内容。

### 目标用户
- **主要用户**: 新闻研究人员、内容创作者、市场分析师
- **次要用户**: 个人用户、企业信息部门、学术研究者
- **技术用户**: 开发者、数据分析师

### 核心价值主张
- **多源聚合**: 整合RSS、Google搜索、Bing搜索等多种数据源
- **智能过滤**: 支持关键词匹配、时间范围、网站限制等高级过滤
- **灵活存储**: 支持JSON、CSV、Parquet多种存储格式
- **自动化**: 支持定时任务和批量处理
- **全球访问**: 支持代理配置，适用于不同网络环境

## 🎯 功能需求

### 1. 数据源管理

#### 1.1 RSS订阅功能
**需求描述**: 支持多个RSS源的自动采集和处理

**功能特性**:
- ✅ 支持添加/删除RSS源
- ✅ 支持RSS源列表管理
- ✅ 智能重试机制（指数退避）
- ✅ RSS内容解析和清理
- ✅ 支持多种RSS格式和版本

**技术实现**:
- 使用feedparser库进行RSS解析
- 内置网络错误处理和重试机制
- 支持HTML标签清理和内容提取
- 支持多种时间格式解析

#### 1.2 Google搜索功能
**需求描述**: 基于Playwright的Google搜索功能，支持高级搜索语法

**功能特性**:
- ✅ 支持Google高级搜索语法
- ✅ 双重方案：requests优先，playwright备用
- ✅ 支持代理配置（HTTP/SOCKS5）
- ✅ 反爬虫机制（随机延时、用户代理轮换）
- ✅ 智能解析算法（基于role='heading'定位）

**高级搜索语法**:
- `site:example.com` - 限制搜索域名
- `after:2024-01-01` - 日期范围过滤
- `before:2024-12-31` - 日期范围过滤
- `intitle:"关键词"` - 标题匹配
- `inurl:关键词` - URL匹配
- `filetype:pdf` - 文件类型过滤
- `-排除词` - 排除关键词

#### 1.3 Bing搜索功能
**需求描述**: 备用搜索引擎，提供Google搜索的替代方案

**功能特性**:
- ✅ 基于requests的轻量级实现
- ✅ 支持代理配置
- ✅ 简化的解析逻辑
- ✅ 作为Google搜索的补充

#### 1.4 新闻API支持
**需求描述**: 预留新闻API接口，支持集成第三方新闻服务

**功能特性**:
- ✅ 可配置的API密钥管理
- ✅ 标准化的新闻数据格式
- ✅ 错误处理和重试机制

### 2. 搜索和过滤功能

#### 2.1 关键词搜索
**需求描述**: 支持多种关键词匹配模式

**匹配模式**:
- 普通包含匹配
- 精确匹配（引号包围）
- 排除匹配（负号开头）
- 短语匹配（包含空格）
- 组合匹配（AND/OR逻辑）

#### 2.2 高级过滤选项
**需求描述**: 提供丰富的搜索过滤选项

**过滤选项**:
- 网站限制：限制搜索特定网站
- 时间范围：支持日期范围和最近N天
- 内容类型：支持文件类型过滤
- 标题过滤：标题必须包含关键词
- URL过滤：URL中包含关键词

### 3. 数据存储功能

#### 3.1 多格式存储
**需求描述**: 支持多种数据存储格式

**存储格式**:
- ✅ JSON：结构化数据存储
- ✅ CSV：表格格式，便于分析
- ✅ Parquet：高效的列式存储

#### 3.2 存储管理
**需求描述**: 智能的文件管理和组织

**功能特性**:
- 自动文件命名（包含日期、关键词、格式）
- 数据目录管理
- 文件格式转换
- 存储空间优化

### 4. 定时任务功能

#### 4.1 任务调度
**需求描述**: 支持自动化新闻收集任务

**调度选项**:
- 间隔调度：每N小时执行一次
- 定时调度：每天固定时间执行
- 立即执行：手动触发任务

#### 4.2 任务管理
**需求描述**: 完整的任务生命周期管理

**功能特性**:
- 任务列表查看
- 任务添加/删除
- 任务启动/停止
- 任务状态监控

### 5. 配置管理功能

#### 5.1 配置文件管理
**需求描述**: 灵活的配置系统

**配置结构**:
- 默认配置（default.yaml）
- 用户配置（user_config.yaml）
- 配置继承和覆盖机制

#### 5.2 数据源配置
**需求描述**: 各数据源的详细配置

**配置项**:
- RSS源列表和超时设置
- Google搜索延时和代理设置
- Bing搜索配置
- News API密钥管理

### 6. 代理和网络支持

#### 6.1 代理配置
**需求描述**: 完善的代理支持系统

**代理类型**:
- HTTP代理
- SOCKS5代理
- 带认证的代理

#### 6.2 网络优化
**需求描述**: 针对不同网络环境的优化

**优化策略**:
- 中国大陆用户代理配置
- 网络超时处理
- 连接重试机制
- 请求频率控制

## 🛠️ 技术架构

### 系统架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   CLI Interface │    │  Config Manager │    │  Data Sources   │
│                 │    │                 │    │                 │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │   Commands  │ │    │ │   Default   │ │    │ │     RSS      │ │
│ └─────────────┘ │    │ │   Config    │ │    │ └─────────────┘ │
│ ┌─────────────┐ │    │ └─────────────┘ │    │ ┌─────────────┐ │
│ │     Main    │ │    │ ┌─────────────┐ │    │ │   Google    │ │
│ └─────────────┘ │    │ │  User Config│ │    │ └─────────────┘ │
│ ┌─────────────┐ │    │ └─────────────┘ │    │ ┌─────────────┐ │
│ │    Parser   │ │    │                 │    │ │    Bing      │ │
│ └─────────────┘ │    └─────────────────┘    │ └─────────────┘ │
└─────────────────┘                             └─────────────────┘
         │                                               │
         └───────────────────────┬───────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              Core Components                     │
         │                                                 │
         │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
         │ │   Scheduler │ │   Storage    │ │    Utils    │ │
         │ └─────────────┘ └─────────────┘ └─────────────┘ │
         └─────────────────────────────────────────────────┘
```

### 核心模块

#### 1. 数据源模块 (data_sources)
- **base.py**: 抽象基类和新闻数据模型
- **rss.py**: RSS订阅数据源
- **google_search.py**: Google搜索数据源
- **bing_search.py**: Bing搜索数据源
- **news_api.py**: 新闻API数据源
- **search_engine.py**: 通用搜索引擎接口

#### 2. 存储模块 (storage)
- **base.py**: 存储抽象基类
- **json_storage.py**: JSON格式存储
- **csv_storage.py**: CSV格式存储
- **parquet_storage.py**: Parquet格式存储
- **manager.py**: 存储管理器

#### 3. 配置模块 (core)
- **config.py**: 配置管理系统
- **scheduler.py**: 任务调度器

#### 4. CLI模块 (cli)
- **main.py**: 命令行入口
- **commands.py**: 命令实现

### 技术栈

#### 核心依赖
- **Python 3.12+**: 主要开发语言
- **Click**: 命令行界面框架
- **PyYAML**: 配置文件解析
- **Rich**: 美化CLI输出

#### 数据源依赖
- **feedparser**: RSS解析
- **requests**: HTTP请求
- **playwright**: 浏览器自动化
- **beautifulsoup4**: HTML解析

#### 存储依赖
- **pandas**: 数据处理
- **pyarrow**: Parquet格式支持

#### 调度依赖
- **schedule**: 任务调度

## 📊 性能要求

### 1. 性能指标
- **RSS获取**: 单个RSS源处理时间 < 30秒
- **Google搜索**: 单次搜索完成时间 < 2分钟
- **并发处理**: 支持多RSS源并发获取
- **内存使用**: 正常运行时内存占用 < 100MB

### 2. 可靠性要求
- **错误恢复**: 网络错误自动重试
- **数据完整性**: 保证新闻数据不丢失
- **系统稳定性**: 7×24小时稳定运行
- **异常处理**: 完善的异常捕获和处理

### 3. 扩展性要求
- **插件化**: 数据源可插拔扩展
- **配置化**: 支持动态配置更新
- **API化**: 预留API接口扩展
- **国际化**: 支持多语言界面

## 🔒 安全考虑

### 1. 数据安全
- **敏感信息**: 代理认证信息加密存储
- **访问控制**: 配置文件权限控制
- **日志安全**: 不记录敏感信息

### 2. 网络安全
- **代理验证**: 代理服务器连接验证
- **请求限制**: 避免过度请求
- **证书验证**: HTTPS证书验证

### 3. 使用合规
- **服务条款**: 遵守Google等服务条款
- **robots.txt**: 尊重网站爬虫规则
- **版权声明**: 仅用于个人学习和研究

## 📅 发布计划

### Phase 1: 核心功能 (已完成)
- ✅ RSS订阅功能
- ✅ Google搜索功能
- ✅ 基础存储功能
- ✅ CLI命令行界面
- ✅ 配置管理系统

### Phase 2: 增强功能 (当前阶段)
- ✅ Bing搜索功能
- ✅ 高级过滤选项
- ✅ 定时任务功能
- ✅ 代理支持优化
- ✅ 错误处理增强

### Phase 3: 高级功能 (规划中)
- 🔄 Web界面管理
- 🔄 数据分析功能
- 🔄 通知系统
- 🔄 云存储集成
- 🔄 多语言支持

## 📈 成功指标

### 1. 技术指标
- 系统稳定性：99.9%可用性
- 搜索成功率：>95%
- 数据准确性：>98%
- 响应时间：<2秒

### 2. 用户指标
- 用户满意度：>4.5/5
- 功能使用率：>80%
- 错误率：<1%
- 用户留存：>90%

### 3. 业务指标
- 新闻收集量：日均>1000条
- 数据源覆盖：>50个主流源
- 搜索效率：提升10倍
- 自动化程度：>95%

## 🤝 风险评估

### 技术风险
- **反爬虫机制**: Google可能加强反爬虫措施
- **代理稳定性**: 代理服务可能不稳定
- **网络限制**: 某些地区网络访问限制

### 缓解措施
- 多种搜索方案备份
- 代理池和IP轮换
- 本地缓存和重试机制
- 持续的技术更新

---

**文档版本**: v1.0  
**创建日期**: 2024-08-04  
**最后更新**: 2024-08-04  
**文档状态**: 已完成

*本PRD文档基于当前项目分析生成，涵盖了News Agent项目的完整功能需求和技术架构。*